
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>客服管理</title>
    <link rel="stylesheet" href="../../css/bootstrap.min.css">
    <link rel="stylesheet" href="../../css/layui.css">
    <!--引入wangEditor.css-->
    <link href="../../summernote.css" rel="stylesheet"/>
    <link rel="stylesheet" href="../../css/mystyle.css?v=4">
    <script src="../../js/common.js?v=2"></script>
    <style>
        #tabinfo_ct td {
            font-size: 14px;
            color: #666;
            height: 28px;
        }
        #clk_hdpic_ct_hd {
            box-shadow: 0px 0px 14px rgba(255, 102, 0, 0.3);
        }
        #clk_hdpic_ct a.chghdpic {
            display: block;
            color: #4FB910;
            border: 1px solid #4FB910;
            border-radius: 10px;
            font-size: 12px;
            text-align: center;
            width: 60px;
            height: 18px;
            line-height: 18px;
            background-color: #fff;
        }
        #tabinfo_ct td.tabinfo_ct_val {
            color: #444;
        }
        #edit_cpinfo {
            display: inline-block;
            color: #4FB910;
            border: 1px solid #4FB910;
            margin-left: 8px;
            width: 38px;
            height: 18px;
            line-height: 18px;
            cursor: pointer;
            color: #4FB910;
            border-radius: 10px;
            text-align: center;
        }
        .mynavi {
            padding: 25px;
            padding-bottom: 10px;
            padding-top: 20px;
            background: #FAFCFF;
        }
        .mynavi ul,.mynavi ul li {
            padding: 0px;
            margin: 0px;
        }
        .mynavi ul {
            width: 751px;
            height: 45px;
            overflow: hidden;
            background: url('../../images/hui_1.jpg');
            position: relative
        }
        .mynavi ul li {
            width: 158px;
            height: 100%;
            position: absolute;
            top: 0px;
            cursor: pointer;
        }
        .mynavi ul li.nav_1 {
            left: 0px;
            background: url(../../images/an_1.jpg)
        }
        .mynavi ul li.nav_2 {
            left: 150px;
        }
        .mynavi ul li.nav_3 {
            left: 300px;
        }
        .mynavi ul li.nav_4 {
            left: 450px;
        }
        .mynavi ul li.nav_5 {
            left: 600px;
        }
        .clerk_table {
            text-align: center;
        }
        .clerk_table thead th {
            text-align: center;
        }
        .help_info {
            display: none;
        }
    </style>
</head>
<body class="layui-layout-body">
    <div style="padding:0 10px;">
        <div class="location">
            您当前的位置：CC客服 &gt; <span>客服管理</span>
        </div>
        <div class="tipsbar_default" style="padding-left:10px;">
            <p style="line-height:20px;">
                <span class="span_dot">●&nbsp;</span>请注意，状态为“<label style="color:green;">启用</label>”的客服才可以接待访客哦，状态为“<label style="color:#F60;">禁用</label>”的客服将无法接收访客消息。&nbsp;&nbsp;&nbsp;<span style="font-weight:bold;">客服设置指引</span>：<a target="_self" href="javascript:;" class="to_add_clerk">①添加客服账号</a> &nbsp;&gt;&nbsp;
                <a target="_self" href="index.php?c=ClerkSet&amp;opencls=1" onclick="parent.change_to_func('nav_setting_center','item-1-1',$(this).attr('href'));return false">②分配网站客服</a><br>
                <span class="span_dot">●&nbsp;</span>抱歉，您的服务已过期，当前可启用<font color="red">0个</font>客服座席，
                <span style="color:#FB456C;font-family:'Microsoft YaHei','微软雅黑';">如需继续使用，请 <a style="color:#F8F8F8;background-color:#DF4163;border-radius:3px;" onclick="parent.change_to_func('account_center','item-11-2','?c=AccountCenter&amp;a=purchaseService&amp;act=5');return false" href="javascript:;">&nbsp;点击此处购买&nbsp;</a></span>
            </p>
        </div>
        <div style="margin:6px 0;margin-top:12px;height:30px;">
            <div class="search_group_c" style="float:left;">
                <form action="?c=Urlmanage" method="post">
                    <input class="search_group_text" value="" name="keyword" type="text" placeholder="输入站点名称或网址关键字" autocomplete="off">
                    <button class="search_group_btn" type="submit"></button>
                </form>
            </div>
            <div style="float:right;">
                <input id="add_webbt" type="button" class="button2 btn_addwebsite" style="width:136px;" value="添加客服帐号">
            </div>
        </div>
        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="tab_11 weblisttab table_default clerk_table" style="margin-left:0px;">
            <thead>
                <tr>
                    <th scope="col">
                        CC账号
                    </th>
                    <th scope="col">
                        姓名
                    </th>
                    <th scope="col">
                        手机
                    </th>
                    <th scope="col">
                        邮箱
                    </th>
                    <th scope="col">
                        角色
                    </th>
                    <th scope="col">
                        操作
                    </th>
                </tr>
            </thead>
            <tbody>
                <!--<tr>-->
                    <!--<td style="text-align:left;text-indent:20px;word-wrap: break-word;word-break:break-all;">-->
                        <!--http://linheqin.com-->
                    <!--</td>-->
                    <!--<td style="text-align:left;word-wrap: break-word;word-break:break-all;">-->
                        <!--http://linheqin.com-->
                    <!--</td>-->
                    <!--<td>-->
                        <!--<a class="wfp_219" onclick="parent.changeWebsiteSelectVal(133299);" href="index.php?c=ClerkSet&amp;up_slc=1&amp;webid=133299">已分配</a>-->
                    <!--</td>-->
                    <!--<td class="codestate" rel="133299">-->
                        <!--<span class="getcodeBtn" onclick="getCodeForm(133299, 'http://linheqin.com', 1)">获取代码</span>-->
                    <!--</td>-->
                    <!--<td rel="133299">-->
                        <!--<span class="getlinkBtn" onclick="getCodeForm(133299, 'http://linheqin.com', 2)">获取链接</span>-->
                    <!--</td>-->
                    <!--<td rel="zh-cn">-->
                        <!--简体中文-->
                    <!--</td>-->
                    <!--<td>-->
                        <!--2018-01-02-->
                    <!--</td>-->
                    <!--<td>-->
                        <!--<a onclick="return false;" fin="133299" href="javascript:void(0)">修改</a> | <a onclick="return false;" href="index.php?c=Urlmanage&amp;a=del&amp;id=133299&amp;page=1" rel="del">删除</a>-->
                    <!--</td>-->
                <!--</tr>-->
            </tbody>
        </table>
        <div class="page_str_ct"></div>
    </div>
    <div class="layui-footer"></div>
    <script src="../../js/jq.js"></script>
    <script src="../../js/bootstrap.min.js"></script>
    <script src="../../js/layui.js"></script>
    <script src="../../js/myscript.js"></script>
    <script>
        var req = getQueryString();
        var companyId = req["companyId"];
        var memberId = req["memberId"];

        // 点击客服帐号
        $("#add_webbt").on("click", function(){
            var addServerUserStr =
                '<form action="" id="addServerUserData" style="padding-top: 10px">' +
                    '<div class="layui-form-item">' +
                        '<label class="layui-form-label"><span style="color: #f20;padding-right: 2px;">*</span>姓名:</label>'+
                        '<div class="layui-input-block">'+
                            '<input type="text" name="username" id="add_name" lay-verify="required" placeholder="请输入姓名"  class="layui-input">'+
                        '</div>'+
                    '</div>'+
                    '<div class="layui-form-item">' +
                        '<label class="layui-form-label">角色:</label>'+
                        '<div class="layui-input-block">'+
                            '<select class="form-control" name="role" id="addWebSiteSelect">'+
                                '<option value="cn">应用管理员</option>'+
                                '<option value="cn">普通客服</option>'+
                            '</select>'+
                        '</div>'+
                    '</div>'+
                    '<div class="layui-form-item">' +
                        '<label class="layui-form-label">手机:</label>'+
                        '<div class="layui-input-block">'+
                            '<input type="text" name="mobile" id="add_mobile" lay-verify="required" placeholder="请输入手机号码" class="layui-input">'+
                        '</div>'+
                    '</div>'+
                    '<div class="layui-form-item">' +
                        '<label class="layui-form-label"><span style="color: #f20;padding-right: 2px;">*</span>邮箱:</label>'+
                        '<div class="layui-input-block">'+
                            '<input type="text" name="email" id="add_email" lay-verify="required" placeholder="请输入邮箱" class="layui-input">'+
                        '</div>'+
                    '</div>'+
                    '<div class="layui-form-item">' +
                        '<label class="layui-form-label"><span style="color: #f20;padding-right: 2px;">*</span>密码:</label>'+
                        '<div class="layui-input-block">'+
                            '<input type="text" name="password" id="add_pwd" lay-verify="required" placeholder="请输入密码" class="layui-input">'+
                        '</div>'+
                    '</div>'+
                    '<div class="layui-form-item">' +
                        '<label class="layui-form-label"><span style="color: #f20;padding-right: 2px;">*</span>确认密码:</label>'+
                        '<div class="layui-input-block">'+
                            '<input type="text" name="password1" id="add_pwd1" lay-verify="required" placeholder="请输入确认密码" class="layui-input">'+
                        '</div>'+
                    '</div>'+
                '</form>';
            var addServerUser = parent.layer.open({
                type: 1,
                area: ['370px'],
                btn: ['确认', '取消'],
                skin: 'clerk_manage_mask',
                content: addServerUserStr,
                yes: function(index, layero){
                    var add_name = $("body",parent.document).find("#add_name").val();
                    var add_email = $("body",parent.document).find("#add_email").val();
                    var add_pwd = $("body",parent.document).find("#add_pwd").val();
                    var add_pwd1 = $("body",parent.document).find("#add_pwd1").val();

                    if(add_name == ""){
                        msgMask("姓名不能为空！",1)
                        return;
                    }
                    if(add_email == ""){
                        msgMask("邮箱不能为空！",1)
                        return;
                    }
                    if(add_pwd == ""){
                        msgMask("密码不能为空！",1)
                        return;
                    }
                    if(add_pwd1 == ""){
                        msgMask("确认密码不能为空！",1)
                        return;
                    }
                    if(add_pwd != add_pwd1){
                        msgMask("密码不一致！",1)
                        return;
                    }

                    var formData = $("body",parent.document).find("#addServerUserData").serialize();
                    $.ajax({
                        url: urlParam.addSupport,
                        dataType: "json",
                        xhrFields: {
                            withCredentials: true
                        },
                        crossDomain: true,
                        data: formData,
                        success: function (msg) {
                            console.log(msg);
                            if(msg.code == 0) {
                                addServerUserList();
                                parent.layer.close(addServerUser);
                            } else {
                                msgMask(msg.message,1)
                            }
                        }
                    })

                }
            })
        })


        // 客服列表
        addServerUserList()
        function addServerUserList(){
            $.ajax({
                url: urlParam.memberList,
                dataType: "json",
                xhrFields: {
                    withCredentials: true
                },
                crossDomain: true,
                // data: formData,
                success: function (msg) {
                    console.log(msg);
                    var dataArr = msg.data;
                    if(msg.code == 0) {
                        if(dataArr.length == 0) {
                            var strHTML = "<tr><td colspan='8'>暂无客服信息！</td></tr>"
                        } else {
                            var strHTML = "";
                            for(var i = 0; i < dataArr.length; i++) {
                                var ccUserName = "CC" + dataArr[i].id || "-";
                                var name = dataArr[i].username || "-";
                                var mobile = dataArr[i].mobile || "-";
                                var email = dataArr[i].email || "-";
                                var dataId = dataArr[i].id || "";
                                var role = dataArr[i].role || "-";
                                strHTML +=
                                    "<tr>" +
                                    "<td>"+ ccUserName + "</td>" +
                                    "<td>"+ name +"</td>" +
                                    "<td>"+ mobile +"</td>" +
                                    "<td>"+ email +"</td>" +
                                    "<td>"+ role +"</td>" +
                                    "<td><a class='modify_sever_btn' href='javascript:void(0);' data-id='"+dataId+"'>修改</a></td>" +
                                    "</tr>";
                            }
                            $(".weblisttab tbody").html(strHTML);
                        }
                    } else {
                        msgMask(msg.message,1)
                    }
                }
            })
        }

        // 修改客服列表
        $(document).on("click", ".modify_sever_btn", function(){
            var modify_name = $(this).parents("tr").find("td:nth-child(1)").text();
            var modify_email = $(this).parents("tr").find("td:nth-child(4)").text();
            var modify_mobile = $(this).parents("tr").find("td:nth-child(3)").text();

            var addServerUserStr =
                '<form action="" id="modifyServerUserData" style="padding-top: 10px">' +
                    '<div class="layui-form-item">' +
                        '<label class="layui-form-label"><span style="color: #f20;padding-right: 2px;">*</span>帐号:</label>'+
                        '<div class="layui-input-block">'+
                            '<input type="text" name="username" readonly value="'+ modify_name +'" id="modify_name"  placeholder="请输入姓名"  class="layui-input">'+
                        '</div>'+
                    '</div>'+
                    '<div class="layui-form-item">' +
                        '<label class="layui-form-label">角色:</label>'+
                        '<div class="layui-input-block">'+
                            '<select class="form-control" name="role" id="modifyWebSiteSelect">'+
                                '<option value="0">应用管理员</option>'+
                                '<option value="1">普通客服</option>'+
                            '</select>'+
                        '</div>'+
                    '</div>'+
                    '<div class="layui-form-item">' +
                        '<label class="layui-form-label">手机:</label>'+
                        '<div class="layui-input-block">'+
                            '<input type="text" name="mobile" value="'+ modify_mobile +'" id="modify_mobile" placeholder="请输入手机号码" class="layui-input">'+
                        '</div>'+
                    '</div>'+
                    '<div class="layui-form-item">' +
                        '<label class="layui-form-label"><span style="color: #f20;padding-right: 2px;">*</span>邮箱:</label>'+
                        '<div class="layui-input-block">'+
                            '<input type="text" name="email" value="'+ modify_email +'" id="modify_email" placeholder="请输入邮箱" class="layui-input">'+
                        '</div>'+
                    '</div>'+
                    '<div class="layui-form-item">' +
                        '<label class="layui-form-label"><span style="color: #f20;padding-right: 2px;">*</span>密码:</label>'+
                        '<div class="layui-input-block">'+
                            '<input type="text" name="password" id="modify_pwd" lay-verify="required" placeholder="请输入密码" class="layui-input">'+
                        '</div>'+
                    '</div>'+
                    '<div class="layui-form-item">' +
                        '<label class="layui-form-label"><span style="color: #f20;padding-right: 2px;">*</span>确认密码:</label>'+
                        '<div class="layui-input-block">'+
                            '<input type="text" name="password1" id="modify_pwd1" placeholder="请输入确认密码" class="layui-input">'+
                        '</div>'+
                    '</div>'+
                '</form>';
            var addServerUser = parent.layer.open({
                type: 1,
                area: ['370px'],
                btn: ['确认', '取消'],
                skin: 'clerk_manage_mask',
                content: addServerUserStr,
                yes: function(index, layero){
                    var modify_name = $("body",parent.document).find("#modify_name").val();
                    var modify_email = $("body",parent.document).find("#modify_email").val();
                    var modify_pwd = $("body",parent.document).find("#modify_pwd").val();
                    var modify_pwd1 = $("body",parent.document).find("#modify_pwd1").val();

                    if(modify_name == ""){
                        msgMask("姓名不能为空！",1)
                        return;
                    }
                    if(modify_email == ""){
                        msgMask("邮箱不能为空！",1)
                        return;
                    }
                    if(modify_pwd == ""){
                        msgMask("密码不能为空！",1)
                        return;
                    }
                    if(modify_pwd1 == ""){
                        msgMask("确认密码不能为空！",1)
                        return;
                    }
                    if(modify_pwd != modify_pwd1){
                        msgMask("密码不一致！",1)
                        return;
                    }

                    var formData = $("body",parent.document).find("#modifyServerUserData").serialize();
                    $.ajax({
                        url: urlParam.modifyPeoleInfo,
                        dataType: "json",
                        xhrFields: {
                            withCredentials: true
                        },
                        crossDomain: true,
                        data: formData,
                        success: function (msg) {
                            console.log(msg);
                            if(msg.code == 0) {
                                addServerUserList();
                                parent.layer.close(addServerUser);
                            } else {
                                msgMask(msg.message,1)
                            }
                        }
                    })

                }
            })
        })
    </script>
</body>
</html>
