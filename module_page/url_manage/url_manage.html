
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>商家站点</title>
    <link rel="stylesheet" href="../../css/bootstrap.min.css">
    <link rel="stylesheet" href="../../css/layui.css">
    <!--引入wangEditor.css-->
    <link href="../../summernote.css" rel="stylesheet"/>
    <link rel="stylesheet" href="../../css/mystyle.css">
    <script src="../../js/common.js?v=2"></script>
    <style>
        #tabinfo_ct td {
            font-size: 14px;
            color: #666;
            height: 28px;
        }
        #clk_hdpic_ct_hd {
            box-shadow: 0px 0px 14px rgba(255, 102, 0, 0.3);
        }
        #clk_hdpic_ct a.chghdpic {
            display: block;
            color: #4FB910;
            border: 1px solid #4FB910;
            border-radius: 10px;
            font-size: 12px;
            text-align: center;
            width: 60px;
            height: 18px;
            line-height: 18px;
            background-color: #fff;
        }
        #tabinfo_ct td.tabinfo_ct_val {
            color: #444;
        }
        #edit_cpinfo {
            display: inline-block;
            color: #4FB910;
            border: 1px solid #4FB910;
            margin-left: 8px;
            width: 38px;
            height: 18px;
            line-height: 18px;
            cursor: pointer;
            color: #4FB910;
            border-radius: 10px;
            text-align: center;
        }
        .mynavi {
            padding: 25px;
            padding-bottom: 10px;
            padding-top: 20px;
            background: #FAFCFF;
        }
        .mynavi ul,.mynavi ul li {
            padding: 0px;
            margin: 0px;
        }
        .mynavi ul {
            width: 751px;
            height: 45px;
            overflow: hidden;
            background: url('../../images/hui_1.jpg');
            position: relative
        }
        .mynavi ul li {
            width: 158px;
            height: 100%;
            position: absolute;
            top: 0px;
            cursor: pointer;
        }
        .mynavi ul li.nav_1 {
            left: 0px;
            background: url(../../images/an_1.jpg)
        }
        .mynavi ul li.nav_2 {
            left: 150px;
        }
        .mynavi ul li.nav_3 {
            left: 300px;
        }
        .mynavi ul li.nav_4 {
            left: 450px;
        }
        .mynavi ul li.nav_5 {
            left: 600px;
        }
        .help_info {
            display: none;
        }
        .text_index thead tr th:nth-child(1),.text_index tbody tr td:nth-child(1) {
            text-indent: 2em;
        }
    </style>
</head>
<body class="layui-layout-body">
    <div style="padding:0 10px;">
        <div class="location">
            您当前的位置：CC客服 &gt; <span>商家站点</span>
        </div>
        <div class="tipsbar_default" style="padding-left:10px;">
            <p style="line-height:20px;">
                <span class="span_dot">●&nbsp;</span>基础使用流程：<a id="lcaddwb" target="_self" href="javascript:;">添加站点</a> &nbsp;&gt;&nbsp;
                <a target="_self" style="cursor: pointer" onclick="parent.change_to_func('nav_setting_center','item-1-1')">分配接待的客服</a> &nbsp;&gt;&nbsp;
                <a style="cursor: default" href="javascript:;">添加代码至您希望CC客服出现的页面</a>
                <br>
                <span class="span_dot">●&nbsp;</span>您共拥有商家网站券：<label style="font-weight:bold;">2</label> 张（未使用 <label style="font-weight:bold;color:#0F9301;">1</label> 张），如需添加更多站点，请购买“<label style="color:#0066ff;">商家网站券</label><img style="cursor:pointer;margin-left:2px;" class="ck_helptips" data-offset="3" data-html="1.添加站点将扣除您1张网站券，删除站点将返还1张网站券。<br/>2.网站券无使用限制，可永久使用。" data-position="bottom right" data-variation="inverted" src="../../images/tjyw.gif">”。<a style="color:#F8F8F8;background-color:#DF4163;border-radius:3px;font-family:'Microsoft YaHei','微软雅黑';" onclick="parent.change_to_func('account_center','item-11-2','?c=AccountCenter&amp;a=purchaseService&amp;act=6');return false" href="javascript:;">&nbsp;点击此处购买&nbsp;</a>
            </p>
        </div>
        <div style="margin:6px 0;margin-top:12px;height:30px;">
            <div class="search_group_c" style="float:left;">
                <form action="?c=Urlmanage" method="post">
                    <input class="search_group_text" value="" name="keyword" type="text" placeholder="输入站点名称或网址关键字" autocomplete="off">
                    <button class="search_group_btn" type="submit"></button>
                </form>
            </div>
            <div style="float:right;">
                <input id="add_webbt" type="button" class="button2 btn_addwebsite" style="width:136px;" value="添加商家/站点">
            </div>
        </div>
        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="tab_11 text_index weblisttab table_default" style="margin-left:0px;">
            <thead>
                <tr>
                <th scope="col" width="20%">
                    商家/站点名称
                </th>
                <th style="text-align:left;" scope="col" width="19%">
                    商铺地址/网址
                </th>
                <th scope="col" width="11%">
                    接待客服
                </th>
                <th scope="col" width="9%">
                    代码管理
                </th>
                <th scope="col" width="9%">
                    沟通链接
                </th>
                <th scope="col" width="9%">
                    显示语言
                </th>
                <th scope="col" width="10%">
                    添加日期
                </th>
                <th scope="col" width="13%">
                    操作
                </th>
            </tr>
            </thead>
            <tbody>
                <!--<tr>-->
                    <!--<td style="text-align:left;text-indent:20px;word-wrap: break-word;word-break:break-all;">-->
                        <!--<label>http://linheqin.com</label>-->
                    <!--</td>-->
                    <!--<td style="text-align:left;word-wrap: break-word;word-break:break-all;">-->
                        <!--http://linheqin.com-->
                    <!--</td>-->
                    <!--<td>-->
                        <!--<a class="wfp_219" onclick="parent.changeWebsiteSelectVal(133299);" href="index.php?c=ClerkSet&amp;up_slc=1&amp;webid=133299">已分配</a>-->
                    <!--</td>-->
                    <!--<td class="codestate" rel="133299">-->
                        <!--<span class="getcodeBtn" onclick="getCodeForm(133299, 'http://linheqin.com', 1)">获取代码</span>-->
                    <!--</td>-->
                    <!--<td rel="133299">-->
                        <!--<span class="getlinkBtn" onclick="getCodeForm(133299, 'http://linheqin.com', 2)">获取链接</span>-->
                    <!--</td>-->
                    <!--<td rel="zh-cn">-->
                        <!--简体中文-->
                    <!--</td>-->
                    <!--<td>-->
                        <!--2018-01-02-->
                    <!--</td>-->
                    <!--<td>-->
                        <!--<a onclick="return false;" fin="133299" href="index.php?c=Urlmanage&amp;a=edit&amp;id=133299&amp;page=1" rel="edit" enable="1">修改</a> | <a onclick="return false;" href="index.php?c=Urlmanage&amp;a=del&amp;id=133299&amp;page=1" rel="del">删除</a>-->
                    <!--</td>-->
                <!--</tr>-->
            </tbody>
        </table>
        <div class="page_str_ct"></div>
    </div>
    <script src="../../js/jq.js"></script>
    <script src="../../js/bootstrap.min.js"></script>
    <script src="../../js/layui.js"></script>
    <script src="../../js/coment.js"></script>
    <script src="../../js/myscript.js"></script>
    <script>
        $(function(){
            var companyId = getQueryString("companyId");
            var memberId = getQueryString("memberId");

            // 点击增加站点
            $("#add_webbt").on("click", function(){
                var addWebsiteListMask =
                '<form action="" id="websiteListData" style="padding-top: 10px">' +
                    '<div class="layui-form-item">' +
                        '<label class="layui-form-label">站点名称:</label>'+
                        '<div class="layui-input-block">'+
                            '<input type="text" name="name" id="add_name" lay-verify="required" placeholder="请输入站点名称"  class="layui-input">'+
                        '</div>'+
                    '</div>'+
                    '<div class="layui-form-item">' +
                        '<label class="layui-form-label">网址:</label>'+
                        '<div class="layui-input-block">'+
                            '<input type="text" name="site" id="add_site" lay-verify="required" placeholder="请输入网址" class="layui-input">'+
                        '</div>'+
                    '</div>'+
                    '<div class="layui-form-item">' +
                        '<label class="layui-form-label">显示语言:</label>'+
                        '<div class="layui-input-block">'+
                            '<select class="form-control" name="language" id="addWebSiteSelect">'+
                                '<option value="cn">中文</option>'+
                            '</select>'+
                        '</div>'+
                    '</div>'+
                '</form>';
                var addWebSiteMask = parent.layer.open({
                    type: 1,
                    area: ['370px', '225px'],
                    btn: ['确认', '取消'],
                    content: addWebsiteListMask,
                    yes: function(index, layero){
                        var add_name = $("body",parent.document).find("#add_name").val();
                        var add_site = $("body",parent.document).find("#add_site").val();
                        var addWebSiteSelect = $("body",parent.document).find("#addWebSiteSelect").val();

                        if(add_name == ""){
                            msgMask("站点名称不能为空！",1)
                            return;
                        }
                        if(add_site == ""){
                            msgMask("站点不能为空！",1)
                            return;
                        }
                        var reg=/^([hH][tT]{2}[pP]:\/\/|[hH][tT]{2}[pP][sS]:\/\/)(([A-Za-z0-9-~]+)\.)+([A-Za-z0-9-~\/])+$/;
                        if(!reg.test(add_site)){
                            msgMask("网站格式不正确！",1)
                            return;
                        }
                        var formData = $("body",parent.document).find("#websiteListData").serialize();
                        $.ajax({
                            url: urlParam.addWebsite,
                            dataType: "json",
                            xhrFields: {
                                withCredentials: true
                            },
                            crossDomain: true,
                            data: formData,
                            success: function (msg) {
                                console.log(msg);
                                if(msg.code == 0) {
                                    webSiteList();
                                    parent.layer.close(addWebSiteMask);
                                } else {
                                    msgMask(msg.message,1)
                                }
                            }
                        })

                    }
                })
            })

            // 站点列表
            function webSiteList(){
                $.ajax({
                    url: urlParam.getWebsiteList,
                    dataType: "json",
                    xhrFields: {
                        withCredentials: true
                    },
                    crossDomain: true,
                    // data: formData,
                    success: function (msg) {
                        console.log(msg);
                        var dataArr = msg.data;
                        if(msg.code == 0) {
                            if(dataArr.length == 0) {
                                var strHTML = "<tr><td colspan='8'>暂无网站信息！</td></tr>"
                            } else {
                                // var strHTML = "<tr><td colspan='8'>暂无网站信息！</td></tr>"
                                var strHTML = "";
                                for(var i = 0; i < dataArr.length; i++) {
                                    var name = dataArr[i].name || "-";
                                    var site = dataArr[i].site || "-";
                                    var lange = (dataArr[i].site == "cn") ? "简体中文" : "其它语言";
                                    var time = dataArr[i].create_time || "0";
                                    var dataId = dataArr[i].id;
                                    strHTML +=
                                    "<tr>" +
                                        "<td>"+name+"</td>" +
                                        "<td>"+site+"</td>" +
                                        "<td>未分配</td>" +
                                        "<td><button class='layui-btn layui-btn-primary layui-btn-xs'>获取代码</button></td>" +
                                        "<td><button class='layui-btn layui-btn-primary layui-btn-xs'>获取链接</button></td>" +
                                        "<td>"+lange+"</td>" +
                                        "<td>"+time+"</td>" +
                                        "<td><a class='modify_web_site_btn' href='javascript:void(0);' data-id='"+dataId+"'>修改</a> | <a class='del_web_site_btn' href='javascript:void(0);' data-id='"+dataId+"'>删除</a></td>" +
                                    "</tr>";
                                }
                                $(".weblisttab tbody").html(strHTML);
                            }
                        } else {
                            msgMask(msg.message,1)
                        }
                    }
                })
            }
            webSiteList()
            // 修改站点
            $(document).on("click",".modify_web_site_btn", function(){
                var thisId = $(this).attr("data-id");
                var thisName = $(this).parents("tr").find("td:nth-child(1)").text();
                var thisSite = $(this).parents("tr").find("td:nth-child(2)").text();
                console.log(thisId);
                var modifyWebsiteListMask =
                '<form action="" id="modifyWebSiteData" style="padding-top: 10px">' +
                    '<input type="hidden" name="id" value="'+thisId+'">'+
                    '<div class="layui-form-item">' +
                        '<label class="layui-form-label">站点名称:</label>'+
                        '<div class="layui-input-block">'+
                            '<input type="text" name="name" id="modify_name" value="'+thisName+'" placeholder="请输入站点名称"  class="layui-input">'+
                        '</div>'+
                    '</div>'+
                    '<div class="layui-form-item">' +
                        '<label class="layui-form-label">网址:</label>'+
                        '<div class="layui-input-block">'+
                            '<input type="text" name="site" id="modify_site" value="'+thisSite+'" placeholder="请输入网址" class="layui-input">'+
                        '</div>'+
                    '</div>'+
                    '<div class="layui-form-item">' +
                        '<label class="layui-form-label">显示语言:</label>'+
                        '<div class="layui-input-block">'+
                            '<select class="form-control" name="language" id="modifyWebSiteSelect">'+
                                '<option value="cn">中文</option>'+
                            '</select>'+
                        '</div>'+
                    '</div>'+
                '</form>';
                var modifyWebSiteMask = parent.layer.open({
                    type: 1,
                    area: ['370px', '225px'],
                    btn: ['确认', '取消'],
                    content: modifyWebsiteListMask,
                    yes: function(index, layero){
                        var formData = $("body",parent.document).find("#modifyWebSiteData").serialize();
                        $.ajax({
                            url: urlParam.modifyWebSite,
                            dataType: "json",
                            xhrFields: {
                                withCredentials: true
                            },
                            crossDomain: true,
                            data: formData,
                            success: function (msg) {
                                console.log(msg);
                                if(msg.code == 0) {
                                    parent.layer.close(modifyWebSiteMask);
                                    webSiteList()
                                } else {
                                    msgMask(msg.message,1)
                                }
                            }
                        })
                     }
                })
            })
            // 删除站点
            $(document).on("click",".del_web_site_btn", function(){
                var dataId = $(this).attr("data-id");
                parent.layer.open({
                    type: 1,
                    title:"删除商家站点",
                    area: ['370px', '180px'],
                    btn: ['确认', '取消'],
                    content:"<div style='height: 100px;line-height:100px;text-align: center'>您是否删除商家站点？</div>",
                    yes: function(index){
                        $.ajax({
                            url: urlParam.webSiteDelelte,
                            dataType: "json",
                            xhrFields: {
                                withCredentials: true
                            },
                            crossDomain: true,
                            data: {
                                id: dataId
                            },
                            success: function (msg) {
                                console.log(msg);
                                if(msg.code == 0) {
                                    webSiteList()
                                } else {
                                    msgMask(msg.message,1)
                                }
                            }
                        })
                    },
                    btn2: function(){

                    }
                })

            })
        })
    </script>
</body>
</html>
